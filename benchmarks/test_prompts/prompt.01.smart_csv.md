# Project Specification: The "Smart" CSV Normalizer

## 1. Objective
Create a robust Python Command Line Interface (CLI) tool named `smart_clean.py`. The tool's purpose is to ingest a "messy" CSV file, infer its schema (column types), clean the data, and output a strict, machine-readable JSON array.

## 2. The Core Challenge
Unlike a standard pandas import, this tool must handle **ambiguity**. The input CSVs may have:
1.  Metadata rows at the top (e.g., "Report generated on 2025-01-01") before the actual header.
2.  Inconsistent casing in headers.
3.  Mixed types in columns (e.g., a "Price" column containing `$10.00`, `10`, and `Ten`).

The agent must "research" (reason through) a heuristic strategy to identify where the data actually starts and how to normalize it without human intervention.

## 3. Requirements

### Functional Requirements
* **Input:** Accepts a filename via a `--input` or `-i` flag.
* **Header Detection:** The script must algorithmically determine which row is the header row. It cannot assume row 0 is the header.
* **Type Inference:**
    * Detect if a column is `Integer`, `Float`, `Boolean`, `Date` (ISO 8601), or `String`.
    * Convert values to their native Python types in the JSON output.
* **Cleaning:**
    * Strip whitespace from strings.
    * Convert "Yes"/"No"/"True"/"False" (case insensitive) to boolean `True`/`False`.
    * Strip currency symbols (`$`, `â‚¬`) from numeric fields.
* **Output:** Prints a JSON array of objects to `stdout`.

### Non-Functional Requirements
* **Dependencies:** Use standard library `csv` and `json` modules where possible. If `pandas` is used, justify the overhead in the research/comments.
* **Error Handling:** If a row is malformed (too many/few commas), log it to `stderr` but do not crash. Continue processing the rest of the file.

## 4. Acceptance Criteria (Test Cases)

**Input (`messy.csv`):**
```csv
# Confidential Data
# Generated by Legacy System
ID, Name, Is_Active, Join_Date, Balance
1, Vincent, Yes, 2023-11-01, $1,000.00
2, MAGNUS, no, 2024-01-15, 500.50
3, , TRUE, N/A, 0
```

**Expected Output (JSON):**
```json
[
  {
    "id": 1,
    "name": "Vincent",
    "is_active": true,
    "join_date": "2023-11-01",
    "balance": 1000.0
  },
  {
    "id": 2,
    "name": "MAGNUS",
    "is_active": false,
    "join_date": "2024-01-15",
    "balance": 500.5
  },
  {
    "id": 3,
    "name": "",
    "is_active": true,
    "join_date": null,
    "balance": 0.0
  }
]
```

## 5. Research Instructions (For the Agent)

Before writing code, please outline your strategy for:
1. **Header Discovery:** How will you distinguish the header row from metadata rows or data rows?
2. **Type Coercion:** How will you handle a column that looks 90% numeric but has one garbage string? (Strict vs. Lenient mode).
