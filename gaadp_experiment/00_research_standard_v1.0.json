{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gaadp.io/research-artifact/v1.0",
  "title": "GAADP Research Artifact Standard v1.0",
  "description": "Synthesized from 5-agent debate: Theorist, Pragmatist, Security, Product, QA",

  "type": "object",
  "required": ["metadata", "domain", "contracts", "verification", "enforcement"],

  "properties": {
    "metadata": {
      "type": "object",
      "required": ["artifact_id", "maturity_level", "completeness_score", "created_at"],
      "properties": {
        "artifact_id": { "type": "string", "format": "uuid" },
        "parent_artifact": { "type": "string", "format": "uuid", "description": "For version tracking" },
        "maturity_level": {
          "type": "string",
          "enum": ["DRAFT", "REVIEWABLE", "EXECUTABLE", "PRODUCTION"],
          "description": "DRAFT=ambiguities captured, REVIEWABLE=resolved, EXECUTABLE=Hoare contracts, PRODUCTION=attested"
        },
        "completeness_score": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "created_at": { "type": "string", "format": "date-time" },
        "attestation_hash": { "type": "string", "description": "SHA-256 of canonical content" },
        "parent_hash": { "type": "string", "description": "For Merkle chain integrity" }
      }
    },

    "domain": {
      "type": "object",
      "required": ["task_category", "why", "success_criteria"],
      "description": "PRODUCT OWNER: Business context is mandatory",
      "properties": {
        "task_category": {
          "type": "string",
          "enum": ["greenfield", "brownfield", "algorithmic", "systems", "debug"]
        },
        "complexity_tier": { "type": "string", "enum": ["tier1", "tier2", "tier3", "boss"] },
        "why": {
          "type": "string",
          "minLength": 20,
          "description": "Business context - why this exists, who benefits"
        },
        "success_criteria": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["criterion", "test_method", "is_automated"],
            "properties": {
              "criterion": { "type": "string" },
              "test_method": { "type": "string" },
              "is_automated": { "type": "boolean" }
            }
          }
        }
      }
    },

    "contracts": {
      "type": "object",
      "required": ["interface", "examples"],
      "description": "THEORIST: Hoare-style contracts with typed examples",
      "properties": {
        "interface": {
          "type": "object",
          "required": ["inputs", "outputs"],
          "properties": {
            "inputs": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "type", "validation"],
                "properties": {
                  "name": { "type": "string" },
                  "type": { "type": "string", "description": "Python type annotation" },
                  "validation": { "type": "string", "description": "Executable Python expression" },
                  "trust_boundary": { "type": "string", "enum": ["trusted", "untrusted", "mixed"] }
                }
              }
            },
            "outputs": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "type"],
                "properties": {
                  "name": { "type": "string" },
                  "type": { "type": "string" },
                  "postcondition": { "type": "string", "description": "Executable Python expression" }
                }
              }
            },
            "preconditions": {
              "type": "array",
              "items": { "type": "string", "description": "Executable Python expression" }
            },
            "postconditions": {
              "type": "array",
              "items": { "type": "string", "description": "Executable Python expression" }
            },
            "invariants": {
              "type": "array",
              "items": { "type": "string", "description": "Must hold before AND after" }
            }
          }
        },
        "examples": {
          "type": "object",
          "required": ["happy_path", "edge_cases", "error_cases"],
          "description": "PRAGMATIST: Minimum 3 typed examples",
          "properties": {
            "happy_path": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": ["input", "expected_output"],
                "properties": {
                  "input": { "type": "object" },
                  "expected_output": { "type": "object" },
                  "explanation": { "type": "string" }
                }
              }
            },
            "edge_cases": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": ["input", "expected_output", "why_edge"],
                "properties": {
                  "input": { "type": "object" },
                  "expected_output": { "type": "object" },
                  "why_edge": { "type": "string" }
                }
              }
            },
            "error_cases": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": ["input", "expected_exception"],
                "properties": {
                  "input": { "type": "object" },
                  "expected_exception": { "type": "string" },
                  "explanation": { "type": "string" }
                }
              }
            }
          }
        },
        "ambiguities": {
          "type": "array",
          "description": "PRAGMATIST: Capture ambiguities explicitly, don't hide them",
          "items": {
            "type": "object",
            "required": ["description", "options", "resolution_status"],
            "properties": {
              "description": { "type": "string" },
              "options": { "type": "array", "items": { "type": "string" } },
              "resolution_status": { "type": "string", "enum": ["open", "resolved", "deferred"] },
              "chosen_option": { "type": "string" },
              "rationale": { "type": "string" }
            }
          }
        }
      }
    },

    "verification": {
      "type": "object",
      "required": ["complexity_bounds", "test_oracle"],
      "description": "THEORIST + QA: Decidable verification with executable tests",
      "properties": {
        "complexity_bounds": {
          "type": "object",
          "properties": {
            "time": { "type": "string", "description": "Big-O notation or 'N/A'" },
            "space": { "type": "string" },
            "justification": { "type": "string" }
          }
        },
        "test_oracle": {
          "type": "object",
          "required": ["unit_tests", "property_tests"],
          "description": "QA: 1:1 mapping from requirements to tests",
          "properties": {
            "unit_tests": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "assertion", "traces_to_criterion"],
                "properties": {
                  "name": { "type": "string" },
                  "assertion": { "type": "string", "description": "Executable Python" },
                  "traces_to_criterion": { "type": "integer", "description": "Index into success_criteria" },
                  "priority": { "type": "string", "enum": ["critical", "high", "medium", "low"] }
                }
              }
            },
            "property_tests": {
              "type": "array",
              "description": "PRAGMATIST: Structural properties without oracle knowledge",
              "items": {
                "type": "object",
                "required": ["property", "generator"],
                "properties": {
                  "property": { "type": "string", "description": "e.g., 'len(output) == len(input)'" },
                  "generator": { "type": "string", "description": "Hypothesis-style generator" }
                }
              }
            }
          }
        },
        "regression_markers": {
          "type": "array",
          "items": { "type": "string", "description": "Existing tests that must continue to pass" }
        }
      }
    },

    "enforcement": {
      "type": "object",
      "required": ["security", "governance", "escalation"],
      "description": "SECURITY: Non-negotiable enforcement, not guidelines",
      "properties": {
        "security": {
          "type": "object",
          "required": ["forbidden_patterns", "required_clearance"],
          "properties": {
            "forbidden_patterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Blocklist: eval, pickle, subprocess without validation, etc."
            },
            "data_sensitivity": { "type": "string", "enum": ["public", "internal", "confidential", "pii"] },
            "required_clearance": { "type": "integer", "minimum": 0, "maximum": 3 },
            "trust_boundary_classification": { "type": "string", "enum": ["trusted", "untrusted", "mixed"] }
          }
        },
        "governance": {
          "type": "object",
          "required": ["cost_limit", "max_attempts", "deadline"],
          "description": "Hard limits enforced by runtime, not suggestions",
          "properties": {
            "cost_limit": { "type": "number", "minimum": 0, "description": "USD, hard boundary" },
            "max_attempts": { "type": "integer", "minimum": 1 },
            "deadline": { "type": "string", "format": "date-time", "description": "Escalation at T-0" },
            "max_clarification_rounds": { "type": "integer", "default": 3 }
          }
        },
        "approval_gates": {
          "type": "array",
          "description": "SECURITY: Gates that block transition until signed off",
          "items": {
            "type": "object",
            "required": ["gate_name", "condition", "required_clearance"],
            "properties": {
              "gate_name": { "type": "string" },
              "condition": { "type": "string", "description": "When this gate activates" },
              "required_clearance": { "type": "integer", "minimum": 0, "maximum": 3 },
              "approval_status": { "type": "string", "enum": ["pending", "approved", "denied"] }
            }
          }
        },
        "escalation": {
          "type": "object",
          "required": ["triggers"],
          "description": "PRODUCT: Human escalation as feature, not failure",
          "properties": {
            "triggers": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["condition", "action"],
                "properties": {
                  "condition": { "type": "string" },
                  "action": { "type": "string", "enum": ["notify", "block", "rollback", "human_required"] },
                  "context_to_provide": { "type": "array", "items": { "type": "string" } }
                }
              }
            }
          }
        },
        "attestation": {
          "type": "object",
          "description": "SECURITY: HMAC chain for forensic integrity",
          "properties": {
            "algorithm": { "type": "string", "default": "SHA-256" },
            "signed_by": { "type": "string", "description": "Agent ID" },
            "signature": { "type": "string" },
            "upstream_digest": { "type": "string", "description": "Transitive attestation of dependency chain" }
          }
        }
      }
    },

    "environment": {
      "type": "object",
      "description": "PRAGMATIST: Environmental physics, not just code spec",
      "properties": {
        "runtime": {
          "type": "object",
          "properties": {
            "language": { "type": "string", "description": "e.g., 'Python 3.10+'" },
            "platform": { "type": "string", "description": "e.g., 'linux-x86_64'" }
          }
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "version_constraint"],
            "properties": {
              "name": { "type": "string" },
              "version_constraint": { "type": "string" },
              "hash": { "type": "string", "description": "Lock file hash for reproducibility" }
            }
          }
        },
        "forbidden_dependencies": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "architecture": {
      "type": "object",
      "description": "File topology and integration points",
      "properties": {
        "files": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["path", "purpose"],
            "properties": {
              "path": { "type": "string" },
              "purpose": { "type": "string" },
              "depends_on": { "type": "array", "items": { "type": "string" } }
            }
          }
        },
        "entry_point": { "type": "string" },
        "integration_points": {
          "type": "array",
          "items": { "type": "string", "description": "External systems this connects to" }
        }
      }
    }
  },

  "allOf": [
    {
      "if": { "properties": { "metadata": { "properties": { "maturity_level": { "const": "EXECUTABLE" } } } } },
      "then": {
        "properties": {
          "contracts": {
            "properties": {
              "interface": {
                "required": ["preconditions", "postconditions"]
              }
            }
          }
        }
      }
    },
    {
      "if": { "properties": { "metadata": { "properties": { "maturity_level": { "const": "PRODUCTION" } } } } },
      "then": {
        "properties": {
          "enforcement": {
            "properties": {
              "attestation": {
                "required": ["signed_by", "signature", "upstream_digest"]
              }
            }
          }
        }
      }
    }
  ]
}
